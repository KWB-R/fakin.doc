## Data storage

The [Ten Simple Rules for Digital Data Storage](https://doi.org/10.1371/journal.pcbi.1005097) 
by `r citet("10.1371/journal.pcbi.1005097")` should serve us as a guideline:

>Rule 1: Anticipate How Your Data Will Be Used
>
>Rule 2: Know Your Use Case
>
>Rule 3: Keep Raw Data Raw
>
>Rule 4: Store Data in Open Formats
>
>Rule 5: Data Should Be Structured for Analysis
>
>Rule 6: Data Should Be Uniquely Identifiable
>
>Rule 7: Link Relevant Metadata
>
>Rule 8: Adopt the Proper Privacy Protocols
>
>Rule 9: Have a Systematic Backup Scheme
>
>Rule 10: The Location and Method of Data Storage Depend on How Much Data You Have
>
> --- `r citep("10.1371/journal.pcbi.1005097")`

### Naming

>We name and name and name. Because we do so much of it, we'd better do it well.
>
> --- `r citep(manual["martin2009"])`

#### Folder and File Names

##### General Considerations (source unknown)

Useful file names are meaningful to you and your colleagues and thus allow to 
find files easily. It is useful if your department or project team agrees on the 
following elements of a file name: 

* Vocabulary: Choose a standard vocabulary for file names, so that everyone 
uses a common language

* Punctuation: Decide on conventions for if and when to use punctuation symbols,
capitals, hyphens and spaces. Good practice: Remove spaces from file names or
use punctuation such as underscores and hyphens to separate words e.g.
`AHRC_TechnicalApp_Response_20120925.docx` or
`AHRC-TechnicalApp-Response20120925.docx` rather than `what we got back from
funders about the data stuff.docx`

* Dates: Agree on a logical use of dates so that they display chronologically 
i.e. `YYYY-MM-DD`

* Order: Confirm which element should go first, so that files on the same 
theme are listed together and can therefore be found easily

* Numbers: Specify the amount of digits that will be used in numbering so that 
files are listed numerically e.g. `01`, `002`, etc.

##### Our Choices

* Allowed characters in file and folder names are: 

    + upper case letters `A-Z`, 
    + lower case letters `a-z`, 
    + numbers `0-9`,
    + underscore `_`,
    + hyphen `-`.

* Therefore, 

    + use underscore or hyphen instead of space,
    + use `ae`, `oe`, `ue`, `Ae`, `Oe`, `Ue`, `ss` instead of `ä`, `ö`, `ü`, 
    `Ä`, `Ö`, `Ü`, `ß`

* Code dates in one of these forms:

    + `yyyy-mm-dd` (e.g. `2018-06-28`)
    + `yyyymmdd` (e.g. `20180628`)

* Use hyphen or "camel case" (as in `camelCase`) instead of space or underscore
for compound words:

    + `clean-data` or `cleanData` instead of
    + `clean data` or `clean_data`

* Use uniform spelling for special "objects", such as

    + projects or sites or parameters, see [acronyms](#acronyms)
    + properties, e.g. use always `validiert`, `kalibriert` or `validated`,
    `calibrated` instead of sometimes `val`, sometimes `validiert`, etc.

* Therefore, define so called vocabularies.

* Do not mix languages within one and the same file or folder name: Use
`regen-ereignis` or `rain-event` instead of `regen-event` or `rain-ereignis`.

* Within one project, use either only English names or only German names. 

##### Justification

We process files automatically. Listing or reading files with non-standard
characters in their names very often causes problems. These problems are sometimes 
not easy to  solve. But they are easy to avoid: By sticking to some simple 
restrictive rules when naming files and folders.

Restricting to characters from the base character set defined above avoids 
problems when exchanging files between partners in different countries. 
We may have a problem with a file from Sofia, called

```
Example file from Canasoft жк. Хаджи Димитър, ул.Клисура_Troncons.xml
``` 

and they may have a problem with a file from us, called

```
abgebrochene schmuz- und regenwasserhaltungen schützenstraße nord 2. ba.xls
```

When dates are coded as `yyyy-mm-dd` or `yyyymmdd` the files are automatically 
sorted chronologically when they are sorted alphanumerically by their name. 
Using hyphen to separate year, month and day supports to distinguish these date 
parts visually. Using the hyphen instead of the underscore allows to split a 
file name at underscores without splitting the date into parts. 

Using hyphen or "camel case" for composed words will not split the composed 
words into their parts when splitting file or folder names at underscores.

The restriction of using consistently one language for file and folder names may
be too strict. However, I think we should try this at least for the top level 
[folder structures](#folder-structures).

##### Avoid Very Long File and Folder Names

File and folder names should be as long as necessary to be meaningful but as
short as possible. 

```{block2 type = "rmdwarning"}
In the Windows operating system, long file paths can cause problems when copying
files. If the full path to the target location of a file exceeds a certain 
length (between 255 and 260 characters) you get the following error message 
(here in German): `Die Dateinamen wären zu lang für den Zielordner. Kürzen Sie 
die Dateinamen und wiederholen Sie den Vorgang, oder verwenden Sie einen anderen 
Ort, der einen kürzeren Pfad hat.`
```

This problem can be avoided by 

* avoiding very long file or folder names,
* avoiding very deep [folder structures](#folder-structures).

If folder or file names are generated by software (e.g. logger software, 
modelling software, reference manager) we should check if the software allows to
modify the naming scheme. 

If we nevertheless have to deal with deeply nested folder structures and/or very 
long file or folder names we should store them in a flat folder hierarchy (i.e. 
not in `\\server\projekte$\department-name\projects\project-name\data-work-packages\work-package-one-meaning-the-following\modelling\scenario-one-meaning-the-following\results`).

#### Acronyms {#acronyms}

Acronyms are unique, clear names for objects. They should 

* be short but meaningful and easy to remember, 
* be all lowercase,
* consist of only alphanumeric letters (`a-z`, `0-9`) or the hyphen (`-`). 

##### Projects {#project-acronyms}

```{block2 type = "rmdnote"}
Do we already have rules for naming and spelling of projects and project folders 
or files? 
```

If not, we should, at the start of a project, define official project acronyms.
These are uniform spellings of project names, intended to be used in folder or 
file names.

Whenever we want to indicate the relation to a certain project in a file or 
folder name, we use the project acronym in exactly the typing that was defined.
This is important as we want to distinguish between raw data, processed data and 
project results in our [data workflow](#data-workflow).

The project acronyms are defined in a simple text file 
[`PROJECTS.txt`](#file-projects) in the `//server/projects$` folder, see 
[Project Folder Structure](#project-folder-structure).

```{block2 type = "rmdnote"}
Should we also define three letter codes for projects? That could
be beneficial in tables with each column representing a project or in overview 
plots.
```

##### Organisations

It is very important to know the origin or owner of data. This is an important
piece of [metadata](#metadata) Therefore we define unique
acronyms for the owners of data that we use. The acronyms are defined in a
special file [`ORGANISATIONS.txt`](#file-organisations) 

###	Metadata {#metadata}

What information would someone need to find/re-use your data? E.g.

* Location, 
* Title, 
* Creator name, 
* Description, 
* Date collected?

Why? Metadata are required for interpreting raw data and gaining an overview 
about the available data.

#### Metadata about Raw Data

```{block2, type = 'rmdtip'}
Obtained from whom, when, via whom and which medium, e.g. "E-Mail from A to B 
on 2018-01-25" oder "USB-Stick from C to D personally on 2018-01-26"

Restriction of usage, e.g.  "only for project x", "only within KWB", 
"must not be published"

Description of content and format (meaning of columns, units, measurement 
devices, methods...)
```

#### Metadata about Processed Data

```{block2, type = 'rmdtip'}
**Important metadata for processed data**

von wem (Person), wann, mit welchen Methoden (z.B. Skript) unter welchen 
Randbedingungen (z.B. Versionen von Software, Paketen) erstellt?

Welche Rohdaten wurden verwendet?

keep metadata in plain text file “readme.txt”
```

Tools for metadata tracking and data standards are:

* metadata editor, e.g. online editor of GFZ Potsdam


**Best Practices:**

* Mindestanforderungen definieren (unterschieden nach Roh- und verarbeiteten
  Daten)

* Metadatenstandards prüfen, z. B. DataCite (siehe u.a. ZALF, GFZ Potsdam)

* Werden wir am konkreten Anwendungsfall in den Testprojekten entwickeln

* Metadaten zu Rohdaten sind immer abzulegen. Metadaten zu verarbeiteten Daten
  sind ebenso wichtig. Sie können bei automatisierter Datenverarbeitung aber 
  aus den Skripten geschlossen werden.

**Metadatenstandards**:

Wir wollen einen Metadatenstandard verwenden. 
Beispiele für Metadatenstandards sind (in Klammern stehen Institutionen, die 
unter anderem Daten mit Metadtaen in diesem Standard veröffentlichen):

* DataCite Metadata Schema

    + Leibniz-Zentrum für Agrarlandschaftsforschung e. V. (ZALF)
    
    + Deutsches GeoForschungsZentrum Potsdam (GFZ) (+ ISO + DIF + Dublin Core)

* ISO 19115-2

    + Bundesanstalt für Gewässerkunde (BfG)
    
    + Alfred-Wegener-Institut Helmholtz-Zentrum für Polar- und Meeresforschung
      (AWI)

Die Auswahl erfolgt gemäß einer guten Übertragbarkeit auf die Anforderungen des 
KWB und gemäß der Verfügbarkeit von Tools.

**Tools:**

* Metadaten-Editor, z.B. Online-Editor vom GFZ Potsdam


We propose to define some special files that contain metadata related to 
files and folders. To indicate that these files have a special meaning, the
file names are all uppercase.


***copied from `10_old_german_chapters.Rmd` ***:

Beispiel:

Wenn wir Zeitreihen von den Beliner Wasserbetrieben bekommen, dann haben diese
entweder eine Spalte mit Zeitstempeln oder zwei Spalten mit Zeitstempeln, wobei
die erste den Anfang und die zweite das Ende des Zeitraums enthält, auf den
sich die Messwerte in der entsprechenden Zeile beziehen. 

Wenn nur eine Spalte Zeitstempel enthält, dann ist nicht klar, ob der 
Zeitstempel den Anfang oder das Ende (oder gar einen anderen Zeitpunkt 
innerhalb) des Zeitraums angibt. 

Bei einer Zeitreihe mit fünfminütigen Messwerten, z.B.

```
Zeit                Wert
2018-06-05 16:20:00    0
2018-06-05 16:25:00    1
2018-06-05 16:30:00    2
2018-06-05 16:35:00    3
2018-06-05 16:40:00    4
```
 
ist nicht klar, ob sich der Wert 1 auf den Zeitraum `16:20 - 16:25` oder auf
den Zeitraum `16:25 - 16:30` bezieht.

Dies ist ein Beispiel für eine sehr konkrete Metadatenanforderung. An dieser
Stelle gehen wir meistens von Annahmen aus oder hat jemand von Euch schon mal
eine Aussage darüber von einem BWB-Mitarbeiter erhalten?

Die Kenntnis über den Bezugspunkt des Zeitstempels ist zum Beispiel wichtig beim

* [Erzeugen von Regen-Inputdateien für die Software InfoWorks](#input-infoworks-regen)

In der obigen Beispielzeitreihe ist auch nicht klar, auf welche Zeitzone sich
die Zeitstempel beziehen. Die Zeitzone bzw. die Angabe des UTC-Offsets ist eine
wichtige Metainformation. Am besten wäre es, wenn alle Zeitstempel diese 
Information enthielten, z.B.

```
2018-06-05 16:20:00+02
2018-06-05 16:25:00+02
```

Dann bräuchte man diese Information nicht extra zu führen. 

Metadaten werden oft erst bei Bedarf erhoben, nämlich genau dann, wenn man sich
z.B. die obigen Fragen nach Zeitstempelbezug und Zeitzone stellt. Dann wird
nachgefragt und im besten Fall wird eine Antwort darauf gegeben, z.B. in Form
einer E-Mail. Die Metadaten sind dann in der E-Mail enthalten. 

Fragen:

- Wo und unter welchem Namen legen wir diese E-Mail ab?

Beispiel für Metadaten aus meiner persönlichen Logdatei:

> Regendaten gelesen; ca. 10 Impulse gegen 14:00; Dannecker geschrubbt, 
> neuer Akku: Batterie defect, alte Batterie drin gelassen, 
> Daten auslesen nicht möglich; H=55cm

Das müssen wir irgendwie besser hinkriegen, aber wie?

Die grundlegenden Fragen sind:

- Wer ist für die Ablage von Metadaten verantwortlich?
- Wo werden die Metadaten abgelegt? Direkt bei den Daten oder in einer 
übergeordneten Datei/Datenbank?
- In welchem Format werden die Metadaten abgelegt? Einfaches Textformat vs. 
XML-Format, das sich wohl einfach nur mit Hilfe eines Programms editieren lässt.


#### File PROJECTS.txt {#file-projects}

This file contains the [project acronyms](#project-acronyms) as we want to use 
them e.g. as top-level folder names in our 
[project folder structure](#project-folder-structure).
The projects are grouped by department.

Possible content of `PROJECTS.txt`:

```
# Department SUW (Surface Water)
dswt: DSWT
flusshygiene: Flusshygiene
kuras: KURAS
mia-cso: MIACSO
monitor: MONITOR
ogre: OGRE
reliable-sewer: RELIABLE_SEWER
sema: SEMA
sema-berlin: SEMA Berlin
sema-berlin-2: SEMA Berlin 2
spree-2011: SPREE2011
spree-2011-2: SPREE2011 "reloaded"

# Department GRW (Groundwater)
optiwells: OPTIWELLS
optiwells-2: OPTIWELLS 2
wellma: WELLMA

# Department WWT (Wastewater Treatment)
...
```

In the file `PROJECTS.txt` the project acronyms appear in alphabetical
order. They map the acronym to a project name or a project title and the year
of the start of the project. 

**Question:**
Do we already have a place where "official"
metadata about projects are stored? If yes, the acronym could be included there. But then, everybody should know about it!

#### File ORGANISATIONS.txt {#file-organisations}

Possible content of `ORGANISATIONS.txt`

```
bwb: Berliner Wasserbetriebe
kwb: Kompetenzzentrum Wasser Berlin
uba: Umweltbundesamt
```


### Raw data 

Especially in environmental sciences, raw data often cannot be reproduced (e.g. 
rainfall, river discharge measurements) and are therefore of high value. Thus 
the following rules apply in case of raw data: 

-	can be renamed (in case this is documented in a [metadata](#metadata) file)

-	the content must not be changed

-	will be stored as read-only in an secure area (i.e. one folder contains all 
raw data)


***added from: 04_rawdata.Rmd***

As raw data we define data that we receive from a device or from a project
partner. 

Most of our research results are based on data. We acknowledge the importance
of raw data by

* storing then in a special place where it is specially secured

* describing them with [metadata](#metadata)

Rawdata are stored in the [rawdata folder structure](#rawdata-folder-structure)


###	Data workflow

For each project separation of:

* [raw data](#raw-data) (i.e. `\\server\\rawdata`)

* data processing (i.e. `\\server\\processing`)

* results (i.e. `\\server\\projekte$`)


Raw data are highly valuable because they if necessary cannot or only with high 
costs be reproduced. Thus raw data will be compiled on the highest level (i.e. 
`\\server\\rawdata`) for each `project` and `origin` (e.g. KWB, BWB) as shown 
below:

**Raw data folder structure:**

```
TestProjekt
  BWB
    Regen
      METADATEN
      regen.xls
    Labor
      METADATEN
      labor.xls

  KWB
    Durchfluss
      METADATEN
      q01.csv
      q02.csv
      q03.csv
```

The data processing is a "playground", where different approaches or scenarios
can be tested and where possibly different versions for a specific approach
or scenario are available. The files will be stored here according to the 
corresponding `project` and `topic` and the data processing step, respectively.


**Data processing folder structure:**

```
TestProjekt
  01_Bereinigung
    METADATEN
    regen_roh.csv
    regen.csv
    qualitaet.csv      
    durchfluss.csv
  02_Modellierung
    sommer
    winter
    VERSIONEN
      v0.1
      v1.0
        sommer
        winter
  Software
```

In the results folder only the "reporting relevant" results should be saved. 
Relevant results files (e.g. plots) should be added according to  `project` and 
`project structure` (i.e. per `working package`) in form of links from the 
`data processing` folder structure (see above).


**Results folder structure:**

```
TestProjekt
  Data-Work Packages
    WP1_Monitoring
    WP2_Modellierung
      sommer.lnk
      winter.lnk
```

### Folder Structures {#folder-structures}

Restrictions/Conventions:

* Each top-level folder should represent a project, i.e. should be defined in
the top level file [`PROJECTS.txt`](#file-projects). 
* Each possible owner should be defined in the top level file
[`ORGANISATIONS.txt`](#file-organisations).
* The naming convention for the organisations is the same as for projects.
s)


#### Project Folder Structure {#project-folder-structure}

We said that we want to concentrate on the folder structures within the project 
folders. Nevertheless, we would like to give a recommendation on how the project
folders could be organised within its top level folder. In this structure, there
are no subfolders for the different departments any more. 

```
//server/projects$
- PROJECTS.txt
- project-1/
- project-2/
- project-3/
```

In the `projects$` folder

- each subfolder name should appear in the file [`PROJECTS.txt`](#file-projects)
- there should not be any folder on the top level that does not represent a 
project. 
- there should be no other files on the top level as the files that are
described in this documentation.
- there are no subfolders representing departments any more. The mapping of
projects to departments is done in the file [`PROJECTS.txt`](#file-projects)

#### Rawdata Folder Structure {#rawdata-folder-structure}

We will create a network folder `//server/rawdata$` in which all files
have set the read-only property. We suggest to store raw data by project first
and by the organisation that owns (i.e. generated, provided) the data second. 
This could look like this:

```
//server/rawdata$
- ORGANISATIONS.txt
- PROJECTS.lnk [Symbolic Link to PROJECTS.txt in //server/projects$]
- flusshygiene
  - bwb
  - kwb
  - uba
  - ...
- ogre
  - kwb
  - bwb
  - uba
  - ...
- ...
```


### Versioning

Versioning or version control is the way by which different versions and drafts 
of a document (or file or record or dataset or software code) are managed. 
Versioning involves the process of naming and distinguishing between a series 
of draft documents that leads to a final or approved version in the end. 
Versioning allows you to disclose an audit trail for the revision and update of 
drafts and final versions.


#### Manual 

We propose the following workflow:

- It is only allowed to modify the current file (e.g. `filename.pptx`), which 
contains no version name as postfix

- A version is created by copying the current file. This copy gets a not already 
defined version name as file name ending (e.g. `filename_v0.1.pptx`) 

- The versioned file is moved to a folder `VERSIONS" and set as read-only.

- In the folder `VERSIONS` is a file `VERSIONS.txt`, which contrains addtional 
information on the available version within that folder

**Drawbacks:**

* possibly more time demanding, 

* needs time getting used to it and

* requires high level of discipline


**Advantages:**

* Simple and safe method, which requires not version control software

* Cleaner workspace as old versions are stored in a separate folder

* Sorting by name equals the chronology

**Example:**

```
BestPractices_Workshop.ppt
VERSIONS/
  + VERSIONS.txt
  + BestPractices_Workshop_v0.1.ppt
  + BestPractices_Workshop_v0.2.ppt
  + BestPractices_Workshop_v1.0.ppt
```

Content of file `VERSIONS.txt`:

```
BestPractices_Workshop.ppt
- v0.1: first draft version, written by Michael Rustler
- v0.2: after additions by Hauke Sonnenberg
- v1.0: first final version, after review by Pascale Rouault
```

#### Automatically

The versioning is done automatically in case a version control software, 
like [Git](https://en.wikipedia.org/wiki/Git) or [Subversion](https://en.wikipedia.org/wiki/Apache_Subversion) 
are used. 

At KWB we currently use the following version control software: 

- [Subversion](https://subversion.apache.org): for internally storing programm 
code (e.g. R-scripts/packages) we have an Subversion server, which is accessible 
from the KWB intranet. However, this requires: 

    + the installation of the client software [TortoiseSVN](https://tortoisesvn.net/index.de.html) 
    and a
    
    + valid user account (for accessing the server) which is currently provided by the 
    IT department on request


- [Git](https://git-scm.com/): for publishing programm code external on our KWB organisation group on [Github](https://github.com/KWB-R). Currently all repositories are public (i.e. 
are visible for everyone), but also use of private repositories is possible for 
free as KWB is recognised as non-for-profit company by Github, offering [additional
benefits for free](https://help.github.com/articles/discounted-organization-accounts/#discounts-for-nonprofits-and-libraries)

```{block2 rmdcaution}
Use of version control software is required in case of programming (e.g. in R, 
Python, and so on) and can be useful in case of tracking changes in small text 
files (e.g. configuration files that run a specific R script with different 
parameters for scenario analysis). 
```

**Drawbacks:**

* Special software ([TortoiseSVN](https://tortoisesvn.net/index.de.html)), login 
data for each user on KWB-Server and some basic training are required

* In case of collaborate coding: sticking to 'best-practices' for using version 
control is mandatory, e.g.: 
 
    + timely check in of code changes to the central server, 
    
    + Speaking to each other: so that not two people work at the same time at the 
    same program code in one script as this leads to conflicts that need to be 
    resolved manually, which can be quite time demanding. You are much better off 
    if you avoid this in the upfront by talking to each other

**Advantages:**

* Only one filename per script (file history and code changes are managed either 
internally on a KWB server in case of using TortoiseSVN or externally for code 
hosted on Github) 

* Old versions of scripts can be restored easily 

* Additional comments during `commit` (i.e. at the time of transfering the code 
from the local computer to the central version control system about `why` code 
changes were made and build-in diff-tools for tracking changes improve the 
reproducibility

```{block2,  type='rmdwarning'}
Attention: version control software is not designed for versioning of raw data 
and thus should not be used for it. General thoughts on the topic of 'data 
versioning' are available here: [https://github.com/leeper/data-versioning](https://github.com/leeper/data-versioning) 
```

```{block2, type = 'rmdnote'}

A presentation with different tools for version control is available here: 
[https://www.fosteropenscience.eu/node/597](https://www.fosteropenscience.eu/node/597)

```

###	Organising e-mails

> "Most people now routinely send and receive lots of messages every day and as a 
Yesult, their inbox can get very quickly overloaded with hundreds of personal and
work-related email. Setting aside some time to organise your emails will ensure 
information can be found quickly and easily, and is stored securely.
Why should I organise my email?
Apart from the obvious frustration and time wasted looking for that email you 
remember sending to someone last month, email is increasingly used to store 
important documents and data, often with information related to the attachments 
within the email itself." 
>
> --- [University of Cambridge (2018)](https://www.data.cam.ac.uk/data-management-guide/organising-your-data#Refernces)

**How can I ensure my emails remain organised?**

Here are some general tips to ensure your email remains organised in the long 
term [University of Cambridge, 2018](https://www.data.cam.ac.uk/data-management-guide/organising-your-data#Refernces):

- Delete emails you do not need. Remove any trivial or old messages from your 
inbox and sent items on a regular (ideally daily) basis.

- 	Use folders to store messages. Establish a structured file directory by 
subject, activity or project.

-	Separate personal emails. Set up a separate folder for these. Ideally, you 
should not receive any personal emails to your work email account.

-	Limit the use of attachments. Use alternative and more secure methods to 
exchange data where possible (see ‘data sharing’ for options). If attachments 
are used, exercise version control and save important attachments to other 
places, such as a network drive.


### Managing references 

For managing reference there are plenty of tools available. A detailed overview 
is provided by `r citep(manual["Fenner_2014"])` in the Chapter [Reference Management](http://book.openingscience.org.s3-website-eu-west-1.amazonaws.com/tools/reference_management.html) 
At KWB we use Endnote, for which an internal guideline document ([KWB-EndNote-Guideline-v02.pdf](file://Y:/R&D Templates/Charts Guidelines Checklists/KWB-EndNote-Guideline-v02.pdf), `r add_text_links()`) was developed.
<!-- add_text_links() only adds more details in case of html output as 
defined in "R/add_text.R" -->

###	Data preservation
Data must be retained to support your research findings

Standards: ?5 years?

